<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Windows things &mdash; Sensu Go Ansible Collection  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Releasing the Sensu Go Ansible Collection" href="releases.html" />
    <link rel="prev" title="Documenting Sensu Go Ansible collection" href="documentation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Sensu Go Ansible Collection
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Using Sensu Go Ansible Collection</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-sensu-go-6.html">Quickstart for Sensu Go 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart-sensu-go-5.html">Quickstart for Sensu Go 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../versioning_sensu_go_installation.html">Versioning Sensu Go installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sensu_go_5_6_migration.html">Updating playbooks for Sensu Go 6</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roles.html">Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hacker's guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../hacking.html">Developing Sensu Go Ansible Collection</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="setup.html">Preparing a development environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing Sensu Go Ansible Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker-images.html">Preparing docker images for integration tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">Documenting Sensu Go Ansible collection</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Windows things</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-new-sensu-go-version-manually">Adding new Sensu Go version manually</a></li>
<li class="toctree-l3"><a class="reference internal" href="#automating-version-sync">Automating version sync</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="releases.html">Releasing the Sensu Go Ansible Collection</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_policy.html">Release policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sensu Go Ansible Collection</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../hacking.html">Developing Sensu Go Ansible Collection</a> &raquo;</li>
      <li>Windows things</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/sensu/sensu-go-ansible/blob/master/docs/source/hacking/windows.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="windows-things">
<h1>Windows things<a class="headerlink" href="#windows-things" title="Permalink to this headline"></a></h1>
<p>Working with Windows is a bit different from what most of us are probably used
to since there is no package manager to delegate installation to and services
behave a bit differently. Here is a collection of things that might come in
handy when working with installation and agent role.</p>
<section id="adding-new-sensu-go-version-manually">
<h2>Adding new Sensu Go version manually<a class="headerlink" href="#adding-new-sensu-go-version-manually" title="Permalink to this headline"></a></h2>
<p>As already state, Windows has no built-in package manager backed by a
repository, which means we have to do a bit more work when installing
packages. And this is why our installation role contains a few pieces of
information about the available Sensu Go agent packages.</p>
<p>We can add a new version of Sensu Go for Windows using the following steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Find the version and build we are interested in on <a class="reference external" href="https://packagecloud.io/sensu/stable">packagecloud</a>.</p></li>
<li><p>Download the x64 and x86 msi files from the download page. Use the
download URL from the <a class="reference external" href="https://docs.sensu.io/sensu-go/latest/operations/deploy-sensu/install-sensu/#install-sensu-agents">installation guide</a> as a base and adjust as
needed.</p></li>
<li><p>Extract product codes from the msi packages (document author used orca msi
editor, would be very much interested in a PowerShell script).</p></li>
<li><p>Add a new entry to the roles/install/vars/Windows.yml file.</p></li>
</ol>
</div></blockquote>
</section>
<section id="automating-version-sync">
<h2>Automating version sync<a class="headerlink" href="#automating-version-sync" title="Permalink to this headline"></a></h2>
<p>Because manually extracting the product code from the msi archive is not
something we would like to devote our lives to, we created a script that knows
how to do two things:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>It can check if the variable file is missing any upstream versions.</p></li>
<li><p>It can automatically update the Windows variable file.</p></li>
</ol>
</div></blockquote>
<p>To check for the missing versions in out current file, we can run the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tools/windows-versions.py check roles/install/vars/Windows.yml
The following versions are missing: 6.2.3.3986, 6.2.4.4013, 6.2.5.4040
The following versions are obsolete: 5.20.0.12118, 5.20.1.12427
</pre></div>
</div>
<p>This command will check if our variable file contains any outdated versions and
if it is missing any new versions Sensu released since our last update. The
command also exits with a non-zero status if action is required, which is great
for CI/CD usage.</p>
<p>We also added the common invocation to the Makefile, which makes running check
as simple as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make check_windows_versions
</pre></div>
</div>
<p>Once we know our variables and upstream availability diverged, we can run the
update command to get things back in sync:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tools/windows-versions.py update roles/install/vars/Windows.yml
</pre></div>
</div>
<p>This command will download any missing packages, extract product codes from
them, and update the variable file. By default, temporary files are put ino the
<code class="docutils literal notranslate"><span class="pre">/tmp</span></code> directory, but this is configurable via the <code class="docutils literal notranslate"><span class="pre">--cache</span></code> command-line
switch.</p>
<p>As with the check command, we also added the common invocation to the Makefile,
which allows us to update the variable file with a simple make run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make update_windows_versions
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The update process needs <code class="docutils literal notranslate"><span class="pre">msiinfo</span></code> executable. The package should be
available for most mainstream Linux distributions.</p>
</div>
<p>Once the update is over, we must commit the changes to the variable file and we
are done.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="documentation.html" class="btn btn-neutral float-left" title="Documenting Sensu Go Ansible collection" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="releases.html" class="btn btn-neutral float-right" title="Releasing the Sensu Go Ansible Collection" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, XLAB Steampunk.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>